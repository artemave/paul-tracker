$(document).on('ready page:load', function(){
    var $slider = $('#<%= slider_id %>')

    $slider.noUiSlider({
        connect: true,
        start: [<%= slider_params[:time_window_start].to_i %>, <%= slider_params[:time_window_end].to_i %>],
        range: {
          min: <%= slider_params[:time_window_min].to_i %>,
          max: <%= slider_params[:time_window_max].to_i %>
        }
    }, true)

    var showDate = {
      to: function(value) {
        return (new Date(value * 1000)).toDateString()
      }
    }

    $slider.noUiSlider_pips({
        mode: 'count',
        values: 7,
        density: 3,
        format: showDate
    })

    $slider.Link('lower').to("q[time_window_start]")
    $slider.Link('upper').to("q[time_window_end]")

    $slider.on({
        'change': function() {
          $slider.parent('form').submit()
        }
    })
})
